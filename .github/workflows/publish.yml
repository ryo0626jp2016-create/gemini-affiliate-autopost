name: publish

on:
  schedule:
    - cron: "0 0,3,6,9,12 * * *"   # UTC
  workflow_dispatch: {}

jobs:
  autopost:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show files (debug)
        run: |
          echo "PWD=$(pwd)"
          echo "GITHUB_WORKSPACE=$GITHUB_WORKSPACE"
          ls -la
          echo "---- tree (top-level) ----"
          ls -la $GITHUB_WORKSPACE

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r "$GITHUB_WORKSPACE/requirements.txt"

      - name: Run scheduler
        env:
          WP_BASE_URL2: ${{ secrets.WP_BASE_URL2 }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GEMINI_MODEL: ${{ secrets.GEMINI_MODEL }}
          A8_APP_ID: ${{ secrets.A8_APP_ID }}
          MOSHIMO_AFFILIA_
